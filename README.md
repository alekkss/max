# LaVita Yarn Support Bot

–ë–æ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –¥–ª—è –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã Max.ru, –∫–æ—Ç–æ—Ä—ã–π –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—Å—ã–ª–∞–µ—Ç –≤–æ–ø—Ä–æ—Å—ã –∫–ª–∏–µ–Ω—Ç–æ–≤ –≤ —á–∞—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∏ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞–º –æ—Ç–≤–µ—á–∞—Ç—å —á–µ—Ä–µ–∑ Reply –º–µ—Ö–∞–Ω–∏–∑–º.

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–û–±–∑–æ—Ä](#–æ–±–∑–æ—Ä)
- [–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏](#–æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏)
- [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
- [–£—Å—Ç–∞–Ω–æ–≤–∫–∞](#—É—Å—Ç–∞–Ω–æ–≤–∫–∞)
- [–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è](#–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è)
- [–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ](#–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ)
- [API Reference](#api-reference)
- [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–ø—Ä–æ–µ–∫—Ç–∞)

---

## üéØ –û–±–∑–æ—Ä

**LaVita Yarn Support Bot** ‚Äî —ç—Ç–æ —Ä–µ—à–µ–Ω–∏–µ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ–±—Ä–∞—â–µ–Ω–∏–π –∫–ª–∏–µ–Ω—Ç–æ–≤ –Ω–∞ –ø–ª–∞—Ç—Ñ–æ—Ä–º–µ Max.ru. –ë–æ—Ç –≤—ã—Å—Ç—É–ø–∞–µ—Ç –ø–æ—Å—Ä–µ–¥–Ω–∏–∫–æ–º –º–µ–∂–¥—É –∫–ª–∏–µ–Ω—Ç–∞–º–∏ –∏ –∫–æ–º–∞–Ω–¥–æ–π –ø–æ–¥–¥–µ—Ä–∂–∫–∏, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—è:

- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –ø–µ—Ä–µ—Å—ã–ª–∫—É –≤–æ–ø—Ä–æ—Å–æ–≤ –∫–ª–∏–µ–Ω—Ç–æ–≤ –≤ –≥—Ä—É–ø–ø–æ–≤–æ–π —á–∞—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏
- ‚úÖ –ü—Ä–æ—Å—Ç–æ–π –º–µ—Ö–∞–Ω–∏–∑–º –æ—Ç–≤–µ—Ç–∞ —á–µ—Ä–µ–∑ Reply (–æ–ø–µ—Ä–∞—Ç–æ—Ä—ã –ø—Ä–æ—Å—Ç–æ –Ω–∞–∂–∏–º–∞—é—Ç "–û—Ç–≤–µ—Ç–∏—Ç—å")
- ‚úÖ –ü–æ–ª–Ω—É—é –∏—Å—Ç–æ—Ä–∏—é –ø–µ—Ä–µ–ø–∏—Å–∫–∏ –≤ SQLite –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö –≤ Excel —Å –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥—ã
- ‚úÖ –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è –∏ –ø–æ–¥—Å–∫–∞–∑–∫–∏
- ‚úÖ **–ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏ –º–∞—Å—Å–æ–≤—ã—Ö —Ä–∞—Å—Å—ã–ª–æ–∫** üÜï

### –°—Ü–µ–Ω–∞—Ä–∏–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

```
–ö–ª–∏–µ–Ω—Ç                    –ë–æ—Ç                  –ß–∞—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏
    |
    |-- "–ü—Ä–∏–≤–µ—Ç!" -->     |-- –ü–µ—Ä–µ—Å–ª–∞–µ—Ç --> |
    |                     |                  | –û–ø–µ—Ä–∞—Ç–æ—Ä –≤–∏–¥–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ
    |                     |                  | –∏ –Ω–∞–∂–∏–º–∞–µ—Ç "–û—Ç–≤–µ—Ç–∏—Ç—å"
    |                     |                  |
    |<-- –û—Ç–≤–µ—Ç! ----  |<-- –ü–æ–ª—É—á–∞–µ—Ç –æ—Ç–≤–µ—Ç --|
```

---

## ‚ú® –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–±—ã—Ç–∏–π
- **–°–æ–±—ã—Ç–∏–µ `bot_started`** ‚Äî –∫–ª–∏–µ–Ω—Ç –∑–∞–ø—É—Å—Ç–∏–ª –±–æ—Ç–∞
- **–°–æ–±—ã—Ç–∏–µ `message_created`** ‚Äî –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç–µ
- **–°–æ–±—ã—Ç–∏–µ `message_callback`** üÜï ‚Äî –Ω–∞–∂–∞—Ç–∏–µ –Ω–∞ inline-–∫–Ω–æ–ø–∫—É
- **–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è –ø–æ —Ç–∏–ø–∞–º** ‚Äî —Ä–∞–∑–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –ø–µ—Ä–≤–æ–≥–æ –∏ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∫–æ–Ω—Ç–∞–∫—Ç–∞
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –Ω–æ–º–µ—Ä–æ–≤ —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏—Å—Ç–æ—Ä–∏–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### –°–∏—Å—Ç–µ–º–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö —Å–æ–æ–±—â–µ–Ω–∏–π (–≤—Ö–æ–¥—è—â–∏—Ö –∏ –∏—Å—Ö–æ–¥—è—â–∏—Ö)
- –ú–∞–ø–ø–∏–Ω–≥ –º–µ–∂–¥—É message_id —á–∞—Ç–∞ –∏ user_id –∫–ª–∏–µ–Ω—Ç–∞
- –ü–æ–¥—Å—á—ë—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –æ—Ç–≤–µ—Ç–æ–≤ –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞

### –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è Excel —Ñ–∞–π–ª–æ–≤ —Å –µ–¥–∏–Ω–æ–π –∫–æ–º–∞–Ω–¥—ã `/export`
- –û—Ç—á—ë—Ç—ã –ø–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º
- –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å —Ü–≤–µ—Ç–Ω—ã–º–∏ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏ –∏ –∞–≤—Ç–æ—à–∏—Ä–∏–≤–∫–æ–π –∫–æ–ª–æ–Ω–æ–∫

### –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å üÜï
- **–ö–æ–Ω—Ç—Ä–æ–ª—å –¥–æ—Å—Ç—É–ø–∞** ‚Äî –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–º –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º
- **–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–æ–µ –º–µ–Ω—é** ‚Äî –Ω–∞–≤–∏–≥–∞—Ü–∏—è —á–µ—Ä–µ–∑ inline-–∫–Ω–æ–ø–∫–∏
- **–ú–∞—Å—Å–æ–≤—ã–µ —Ä–∞—Å—Å—ã–ª–∫–∏** ‚Äî —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º –∏–ª–∏ –≤—Å–µ–π –±–∞–∑–µ
- **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞** ‚Äî —Ä–∞—Å—Å—ã–ª–∫–∞ –≤ —Ñ–æ–Ω–æ–≤–æ–º –ø–æ—Ç–æ–∫–µ, –±–æ—Ç –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
- **–ü—Ä–æ–≥—Ä–µ—Å—Å –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏** ‚Äî —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ —Ö–æ–¥–µ —Ä–∞—Å—Å—ã–ª–∫–∏
- **–î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** ‚Äî –æ—Ç—á—ë—Ç —Å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π –∏ –æ—à–∏–±–∫–∞–º–∏
- **–ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä** ‚Äî –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π
- **–û–±—Ö–æ–¥ rate limiting** ‚Äî –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ –∑–∞–¥–µ—Ä–∂–∫–∏ –º–µ–∂–¥—É —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
- Retry –ª–æ–≥–∏–∫–∞ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö API
- –¢–∞–π–º–∞—É—Ç—ã —Å —É–ø—Ä–∞–≤–ª—è–µ–º—ã–º–∏ –∑–∞–¥–µ—Ä–∂–∫–∞–º–∏
- Debug —Ä–µ–∂–∏–º —Å —Ç—Ä–∞—Å—Å–∏—Ä–æ–≤–∫–æ–π –æ—à–∏–±–æ–∫
- –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –æ—à–∏–±–æ–∫ —Ä–∞—Å—Å—ã–ª–∫–∏ (–Ω–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–ª–∏ –±–æ—Ç–∞, –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –∏ —Ç.–¥.)

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–ü—Ä–æ–µ–∫—Ç —Å–ª–µ–¥—É–µ—Ç –ø—Ä–∏–Ω—Ü–∏–ø–∞–º **Clean Architecture** —Å —á–µ—Ç—ã—Ä—ë—Ö-—Å–ª–æ–π–Ω–æ–π –º–æ–¥–µ–ª—å—é:

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ      Presentation Layer             ‚îÇ
‚îÇ  (main.py, BotService)              ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ      Application Layer              ‚îÇ
‚îÇ  (UpdateHandler, Services)          ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ      Domain Layer                   ‚îÇ
‚îÇ  (Models: User, Message, Update)    ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ      Data Layer                     ‚îÇ
‚îÇ  (Repositories, DatabaseConnection) ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-----------|-----------|
| **BotService** | –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª —Ä–∞–±–æ—Ç—ã –±–æ—Ç–∞ (long polling) |
| **UpdateHandler** | –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π –ø–æ —Ç–∏–ø–∞–º |
| **UserService** | –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ |
| **MessageService** | –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ |
| **ExportService** | –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á—ë—Ç–æ–≤ –≤ Excel |
| **AdminService** üÜï | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å—é –∏ —Ä–∞—Å—Å—ã–ª–∫–∞–º–∏ |
| **AdminStateManager** üÜï | –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ |
| **MaxApiClient** | –ö–ª–∏–µ–Ω—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Max.ru API |
| **SQLiteUserRepository** | –°–ª–æ–π –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π |
| **SQLiteMessageRepository** | –°–ª–æ–π –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–π |
| **DatabaseConnection** | –ú–µ–Ω–µ–¥–∂–µ—Ä –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î |

### –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö

```
Max.ru API
    ‚Üì
BotService (long polling)
    ‚Üì
UpdateHandler (–º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è)
    ‚Üì
UserService / MessageService / AdminService (–±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞)
    ‚Üì
Repositories (—Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ/–ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö)
    ‚Üì
SQLite Database
```

---

## üöÄ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Python 3.11+
- pip –∏–ª–∏ uv (–ø–∞–∫–µ—Ç–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä)

### –®–∞–≥–∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∏

1. **–ö–ª–æ–Ω–∏—Ä—É–π—Ç–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π**
```bash
git clone <repository_url>
cd lavita-bot
```

2. **–°–æ–∑–¥–∞–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ**
```bash
python -m venv venv
source venv/bin/activate  # Linux/macOS
# –∏–ª–∏
venv\Scripts\activate  # Windows
```

3. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏**
```bash
pip install requests openpyxl python-dotenv
```

4. **–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env`**
```bash
cp .env.example .env
```

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```env
# Max.ru API –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
API_TOKEN=your_api_token_here
BASE_URL=https://platform-api.max.ru

# IDs
SUPPORT_CHAT_ID=123456789
BOT_ID=987654321

# –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—ã (NEW!)
ADMIN_USER_IDS=123456789,987654321,111222333

# Database
DATABASE_PATH=lavita_bot.db

# Long polling
POLLING_TIMEOUT=30
POLLING_REQUEST_TIMEOUT=35

# –ü–æ–≤–µ–¥–µ–Ω–∏–µ
DEBUG=false
MESSAGE_DELAY=0.3
ERROR_RETRY_DELAY=5

# –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –º–∞—Å—Å–æ–≤—ã—Ö —Ä–∞—Å—Å—ã–ª–æ–∫ (NEW!)
NOTIFICATION_DELAY=0.1
NOTIFICATION_PROGRESS_INTERVAL=100
```

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|-----------|---------|--------|
| `API_TOKEN` | –¢–æ–∫–µ–Ω –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤ Max.ru API | `Bearer xxxx...` |
| `BASE_URL` | –ë–∞–∑–æ–≤—ã–π URL API Max.ru | `https://platform-api.max.ru` |
| `SUPPORT_CHAT_ID` | ID –≥—Ä—É–ø–ø–æ–≤–æ–≥–æ —á–∞—Ç–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ | `123456789` |
| `BOT_ID` | ID —Å–∞–º–æ–≥–æ –±–æ—Ç–∞ | `987654321` |
| **`ADMIN_USER_IDS`** üÜï | –°–ø–∏—Å–æ–∫ user_id –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é | `123,456,789` |
| `DATABASE_PATH` | –ü—É—Ç—å –∫ SQLite –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö | `lavita_bot.db` |
| `POLLING_TIMEOUT` | –¢–∞–π–º–∞—É—Ç –¥–ª—è long polling (—Å–µ–∫) | `30` |
| `DEBUG` | –í–∫–ª—é—á–∏—Ç—å debug —Ä–µ–∂–∏–º | `true` / `false` |
| `MESSAGE_DELAY` | –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏ (—Å–µ–∫) | `0.3` |
| **`NOTIFICATION_DELAY`** üÜï | –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏ –≤ —Ä–∞—Å—Å—ã–ª–∫–µ (—Å–µ–∫) | `0.1` |
| **`NOTIFICATION_PROGRESS_INTERVAL`** üÜï | –ß–∞—Å—Ç–æ—Ç–∞ –ø—Ä–æ–≥—Ä–µ—Å—Å-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π (–∫–æ–ª-–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π) | `100` |

---

## üéÆ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ –±–æ—Ç–∞

```bash
python main.py
```

–í—ã–≤–æ–¥:
```
‚úÖ –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–∞
ü§ñ –ë–æ—Ç LaVita yarn –∑–∞–ø—É—â–µ–Ω!
üì° –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ https://platform-api.max.ru
üí¨ –ß–∞—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏: 123456789
ü§ñ ID –±–æ—Ç–∞: 987654321
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
‚ú® –û–ø–µ—Ä–∞—Ç–æ—Ä—ã –º–æ–≥—É—Ç –ø—Ä–æ—Å—Ç–æ –Ω–∞–∂–∞—Ç—å '–û—Ç–≤–µ—Ç–∏—Ç—å' –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ!
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
```

### –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|---------|---------|
| `/start` | –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞, –ø–æ–ª—É—á–∏—Ç—å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ |
| `/hello` | –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞ –¥–ª—è `/start` |
| –û–±—ã—á–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ | –ü–µ—Ä–µ—Å—ã–ª–∞–µ—Ç—Å—è –≤ —á–∞—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏ |

### –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ | –ú–µ—Å—Ç–æ |
|---------|---------|--------|
| `/export` | –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ Excel | –ß–∞—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏ |
| Reply –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ | –û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–≤–µ—Ç –∫–ª–∏–µ–Ω—Ç—É | –ß–∞—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏ |

### –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤ üÜï

| –ö–æ–º–∞–Ω–¥–∞ | –û–ø–∏—Å–∞–Ω–∏–µ | –ú–µ—Å—Ç–æ |
|---------|---------|--------|
| `/admin` | –û—Ç–∫—Ä—ã—Ç—å –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å | –õ–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –±–æ—Ç—É |

### –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å üÜï

#### –î–æ—Å—Ç—É–ø –∫ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏

–¢–æ–ª—å–∫–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –∏–∑ —Å–ø–∏—Å–∫–∞ `ADMIN_USER_IDS` –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—É `/admin`.

```
–ê–¥–º–∏–Ω: /admin
```

–ë–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–º –º–µ–Ω—é —Å –∫–Ω–æ–ø–∫–∞–º–∏:
```
üîß –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å LaVita

–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:

[üì¢ –û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ]
```

#### –ü—Ä–æ—Ü–µ—Å—Å —Å–æ–∑–¥–∞–Ω–∏—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

**–®–∞–≥ 1: –í—ã–±–æ—Ä –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π**
```
üì¢ –û—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

–í—ã–±–µ—Ä–∏—Ç–µ –ø–æ–ª—É—á–∞—Ç–µ–ª–µ–π:

[üß™ –¢–µ—Å—Ç] [üìä –í—Å—è –±–∞–∑–∞]
[‚óÄÔ∏è –ù–∞–∑–∞–¥]
```

- **üß™ –¢–µ—Å—Ç** ‚Äî –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–æ–ª—å–∫–æ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º (–¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–µ–∫—Å—Ç–∞)
- **üìä –í—Å—è –±–∞–∑–∞** ‚Äî –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

**–®–∞–≥ 2: –í–≤–æ–¥ —Ç–µ–∫—Å—Ç–∞**
```
üìù –°–æ–∑–¥–∞–Ω–∏–µ –º–∞—Å—Å–æ–≤–æ–≥–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –æ—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–µ–∫—Å—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è.
–í—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (–∂–∏—Ä–Ω—ã–π, –∫—É—Ä—Å–∏–≤, —Å—Å—ã–ª–∫–∏),
—Å–º–∞–π–ª—ã –∏ –º–µ–¥–∏–∞—Ñ–∞–π–ª—ã (—Ñ–æ—Ç–æ, –≤–∏–¥–µ–æ).

üéØ –ü–æ–ª—É—á–∞—Ç–µ–ª–∏: 1000 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å(–µ–π)
```

–ê–¥–º–∏–Ω –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–µ–∫—Å—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–±—ã—á–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º.

**–®–∞–≥ 3: –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ**
```
üëÅ –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è:

[–¢–µ–∫—Å—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç –∞–¥–º–∏–Ω–∞]

‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
üéØ –ü–æ–ª—É—á–∞—Ç–µ–ª–∏: 1000 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å(–µ–π)

‚ùì –û—Ç–ø—Ä–∞–≤–∏—Ç—å —ç—Ç–æ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ?

[‚úÖ –î–∞] [‚ùå –ù–µ—Ç]
```

**–®–∞–≥ 4: –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞**

–ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏ "–î–∞" –∞–¥–º–∏–Ω –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ –ø–æ–ª—É—á–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ:
```
üì§ –†–∞—Å—Å—ã–ª–∫–∞ –Ω–∞—á–∞—Ç–∞!
–ü–æ–ª—É—á–∞—Ç–µ–ª–µ–π: 1000
```

–ó–∞—Ç–µ–º –±–æ—Ç –Ω–∞—á–∏–Ω–∞–µ—Ç –æ—Ç–ø—Ä–∞–≤–∫—É –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ. **–í–∞–∂–Ω–æ:** –±–æ—Ç –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –¥—Ä—É–≥–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤–æ –≤—Ä–µ–º—è —Ä–∞—Å—Å—ã–ª–∫–∏!

**–ü—Ä–æ–≥—Ä–µ—Å—Å-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è** (–∫–∞–∂–¥—ã–µ 100 —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é):
```
üìä –ü—Ä–æ–≥—Ä–µ—Å—Å: 10%
‚úÖ –î–æ—Å—Ç–∞–≤–ª–µ–Ω–æ: 95/1000
‚ö†Ô∏è –ù–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–ª–∏: 5
```

```
üìä –ü—Ä–æ–≥—Ä–µ—Å—Å: 50%
‚úÖ –î–æ—Å—Ç–∞–≤–ª–µ–Ω–æ: 485/1000
‚ö†Ô∏è –ù–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–ª–∏: 15
```

**–§–∏–Ω–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:**
```
üéâ –†–∞—Å—Å—ã–ª–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!

üìä –î–æ—Å—Ç–∞–≤–ª–µ–Ω–æ: 945/1000
‚ö†Ô∏è –ù–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–ª–∏ –±–æ—Ç–∞: 55

‚è± –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: 1 –º–∏–Ω 40 —Å–µ–∫
```

#### –ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –æ—à–∏–±–æ–∫

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç –ø—Ä–æ–±–ª–µ–º—ã –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ:

- **‚úÖ –î–æ—Å—Ç–∞–≤–ª–µ–Ω–æ** ‚Äî —Å–æ–æ–±—â–µ–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ
- **‚ö†Ô∏è –ù–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–ª–∏ –±–æ—Ç–∞** ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –µ—Å—Ç—å –≤ –±–∞–∑–µ, –Ω–æ –Ω–µ –∑–∞–ø—É—Å–∫–∞–ª –±–æ—Ç–∞ (`dialog.not.found`)
- **‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω—ã** ‚Äî –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π user_id (`user.not.found`)

### –ü—Ä–∏–º–µ—Ä—ã —Ä–∞–±–æ—Ç—ã

#### –ö–ª–∏–µ–Ω—Ç –ø–∏—à–µ—Ç –≤–æ–ø—Ä–æ—Å
```
–ö–ª–∏–µ–Ω—Ç: –ü—Ä–∏–≤–µ—Ç! –ö–æ–≥–¥–∞ –±—É–¥–µ—Ç –¥–æ—Å—Ç–∞–≤–∫–∞?
```

–†–µ–∑—É–ª—å—Ç–∞—Ç –≤ —á–∞—Ç–µ –ø–æ–¥–¥–µ—Ä–∂–∫–∏:
```
üì® –ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤ (ID: 12345)
üë§ [–ò–≤–∞–Ω –ü–µ—Ç—Ä–æ–≤](max://user/12345)
_–í–æ–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:_

**–ü—Ä–∏–≤–µ—Ç! –ö–æ–≥–¥–∞ –±—É–¥–µ—Ç –¥–æ—Å—Ç–∞–≤–∫–∞?**

üí¨ –û—Ç–≤–µ—Ç–æ–≤: ‚úÖ 0
```

#### –û–ø–µ—Ä–∞—Ç–æ—Ä –æ—Ç–≤–µ—á–∞–µ—Ç
```
–û–ø–µ—Ä–∞—Ç–æ—Ä (Reply): –î–æ—Å—Ç–∞–≤–∫–∞ –∑–∞–π–º–µ—Ç 2-3 –¥–Ω—è!
```

–ö–ª–∏–µ–Ω—Ç –ø–æ–ª—É—á–∞–µ—Ç:
```
üí¨ –î–æ—Å—Ç–∞–≤–∫–∞ –∑–∞–π–º–µ—Ç 2-3 –¥–Ω—è!
```

#### –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
```
–û–ø–µ—Ä–∞—Ç–æ—Ä (–≤ —á–∞—Ç–µ): /export
```

–†–µ–∑—É–ª—å—Ç–∞—Ç:
- –°–æ–∑–¥–∞–µ—Ç—Å—è Excel —Ñ–∞–π–ª —Å –¥–≤—É–º—è –ª–∏—Å—Ç–∞–º–∏: "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏" –∏ "–°–æ–æ–±—â–µ–Ω–∏—è"
- –§–∞–π–ª –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –≤ —á–∞—Ç
- Excel —Ñ–∞–π–ª –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–∫–∞—á–∞–Ω –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–º

#### –ú–∞—Å—Å–æ–≤–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞ üÜï
```
–ê–¥–º–∏–Ω: /admin
[–ù–∞–∂–∏–º–∞–µ—Ç "–û—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ"]
[–í—ã–±–∏—Ä–∞–µ—Ç "–í—Å—è –±–∞–∑–∞"]
[–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Ç–µ–∫—Å—Ç: "–í–Ω–∏–º–∞–Ω–∏–µ! –ó–∞–≤—Ç—Ä–∞ —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–µ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ —Å 02:00 –¥–æ 04:00 –ú–°–ö"]
[–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –æ—Ç–ø—Ä–∞–≤–∫—É]
```

–†–µ–∑—É–ª—å—Ç–∞—Ç:
- 1000 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ–ª—É—á–∞—é—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
- –ê–¥–º–∏–Ω –≤–∏–¥–∏—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å –∫–∞–∂–¥—ã–µ 100 —Å–æ–æ–±—â–µ–Ω–∏–π
- –ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞: –¥–æ—Å—Ç–∞–≤–ª–µ–Ω–æ 945, –Ω–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–ª–∏ 55
- –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è: ~1 –º–∏–Ω—É—Ç–∞ 40 —Å–µ–∫—É–Ω–¥
- **–ë–æ—Ç –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å** –≤–æ –≤—Ä–µ–º—è —Ä–∞—Å—Å—ã–ª–∫–∏

---

## üìö API Reference

### BotService

```python
class BotService:
    def start() -> None
        """–ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞ –≤ —Ä–µ–∂–∏–º–µ long polling"""
    
    def stop() -> None
        """–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –±–æ—Ç–∞"""
    
    def set_update_handler(handler: UpdateHandler) -> None
        """–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏–π"""
```

### UserService

```python
class UserService:
    def register_or_update_user(user_id: int, name: str) -> User
        """–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å –∏–ª–∏ –æ–±–Ω–æ–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    
    def send_welcome_message(user_id: int, name: str) -> None
        """–û—Ç–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ"""
    
    def handle_start_command(user_id: int, name: str) -> None
        """–û–±—Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ–º–∞–Ω–¥—É /start"""
    
    def handle_bot_started(user_id: int, name: str) -> None
        """–û–±—Ä–∞–±–æ—Ç–∞—Ç—å —Å–æ–±—ã—Ç–∏–µ –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞"""
    
    def validate_phone_number(text: str) -> Optional[str]
        """–í–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞"""
    
    def save_phone_number(user_id: int, phone_number: str) -> None
        """–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –Ω–æ–º–µ—Ä —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
```

### MessageService

```python
class MessageService:
    def save_user_message(user_id: int, text: str, message_id: Optional[str]) -> Message
        """–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    
    def save_operator_message(user_id: int, text: str, operator_name: str) -> Message
        """–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞"""
    
    def forward_to_support(user_id: int, user_name: str, text: str) -> Optional[str]
        """–ü–µ—Ä–µ—Å–ª–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏"""
    
    def send_operator_reply(user_id: int, user_name: str, operator_name: str, text: str) -> bool
        """–û—Ç–ø—Ä–∞–≤–∏—Ç—å –æ—Ç–≤–µ—Ç –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ –∫–ª–∏–µ–Ω—Ç—É"""
    
    def get_mapping_by_message_id(message_id: str) -> Optional[MessageMapping]
        """–ü–æ–ª—É—á–∏—Ç—å –º–∞–ø–ø–∏–Ω–≥ –ø–æ message_id"""
```

### AdminService üÜï

```python
class AdminService:
    def is_admin(user_id: int) -> bool
        """–ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º"""
    
    def send_main_menu(user_id: int) -> None
        """–û—Ç–ø—Ä–∞–≤–∏—Ç—å –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏"""
    
    def handle_callback(user_id: int, callback_id: str, payload: str) -> None
        """–û–±—Ä–∞–±–æ—Ç–∞—Ç—å callback-—Å–æ–±—ã—Ç–∏–µ –æ—Ç inline-–∫–Ω–æ–ø–∫–∏"""
    
    def handle_notification_text(user_id: int, text: str) -> None
        """–û–±—Ä–∞–±–æ—Ç–∞—Ç—å —Ç–µ–∫—Å—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ—Ç –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞"""
    
    def is_waiting_notification_text(user_id: int) -> bool
        """–ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –æ–∂–∏–¥–∞–µ—Ç –ª–∏ –∞–¥–º–∏–Ω –≤–≤–æ–¥–∞ —Ç–µ–∫—Å—Ç–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è"""
```

### MaxApiClient

```python
class MaxApiClient:
    def get_updates(marker: Optional[str], timeout: int) -> dict
        """–ü–æ–ª—É—á–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ long polling"""
    
    def send_message_to_user(user_id: int, text: str) -> dict
        """–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é"""
    
    def send_message_to_chat(chat_id: int, text: str) -> dict
        """–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –≥—Ä—É–ø–ø–æ–≤–æ–π —á–∞—Ç"""
    
    def send_message_with_keyboard(text: str, buttons: list, user_id: int) -> dict
        """–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ —Å inline-–∫–ª–∞–≤–∏–∞—Ç—É—Ä–æ–π"""
    
    def answer_callback(callback_id: str, text: str, buttons: list) -> dict
        """–û—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ callback –æ—Ç inline-–∫–Ω–æ–ø–∫–∏"""
    
    def upload_file(file_path: str) -> str
        """–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª –Ω–∞ —Å–µ—Ä–≤–µ—Ä"""
    
    def send_file_to_chat(chat_id: int, file_token: str, text: str, filename: str) -> dict
        """–û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ñ–∞–π–ª –≤ —á–∞—Ç"""
```

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
lavita-bot/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ settings.py              # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ database/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ connection.py            # –ú–µ–Ω–µ–¥–∂–µ—Ä –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î
‚îÇ   ‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user.py                  # –î–æ–º–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å User
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ message.py               # –î–æ–º–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å Message
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ update.py                # –î–æ–º–µ–Ω–Ω–∞—è –º–æ–¥–µ–ª—å Update
‚îÇ   ‚îú‚îÄ‚îÄ repositories/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user_repository.py       # –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ message_repository.py    # –†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å–æ–æ–±—â–µ–Ω–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ bot_service.py           # –ì–ª–∞–≤–Ω—ã–π —Å–µ—Ä–≤–∏—Å –±–æ—Ç–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user_service.py          # –°–µ—Ä–≤–∏—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ message_service.py       # –°–µ—Ä–≤–∏—Å —Å–æ–æ–±—â–µ–Ω–∏–π
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ export_service.py        # –°–µ—Ä–≤–∏—Å —ç–∫—Å–ø–æ—Ä—Ç–∞ –≤ Excel
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ admin_service.py         # üÜï –°–µ—Ä–≤–∏—Å –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ admin_state_manager.py   # üÜï –ú–µ–Ω–µ–¥–∂–µ—Ä —Å–æ—Å—Ç–æ—è–Ω–∏–π –∞–¥–º–∏–Ω–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ handlers/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ update_handler.py        # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —Å–æ–±—ã—Ç–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ clients/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ max_api_client.py        # –ö–ª–∏–µ–Ω—Ç Max.ru API
‚îÇ   ‚îî‚îÄ‚îÄ utils/
‚îÇ       ‚îî‚îÄ‚îÄ admin_constants.py       # üÜï –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
‚îú‚îÄ‚îÄ main.py                          # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ .env                             # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ .env.example                     # –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îî‚îÄ‚îÄ README.md                        # –î–∞–Ω–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

### –û–ø–∏—Å–∞–Ω–∏–µ –∫–ª—é—á–µ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤

#### `main.py` ‚Äî —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞
–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∏ –∑–∞–ø—É—Å–∫–∞–µ—Ç –±–æ—Ç–∞ —Å –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π.

#### `config/settings.py` ‚Äî –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
–ó–∞–≥—Ä—É–∂–∞–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∏—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é.

#### `models/` ‚Äî –¥–æ–º–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏
–°–æ–¥–µ—Ä–∂–∞—Ç dataclass –º–æ–¥–µ–ª–∏ –¥–ª—è —Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:
- `User` ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–∏—Å—Ç–µ–º—ã
- `Message` ‚Äî —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –∏—Å—Ç–æ—Ä–∏–∏
- `Update` ‚Äî —Å–æ–±—ã—Ç–∏–µ –æ—Ç API

#### `repositories/` ‚Äî —Å–ª–æ–π –¥–æ—Å—Ç—É–ø–∞ –∫ –¥–∞–Ω–Ω—ã–º
–ê–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–ª—è SQLite:
- `IUserRepository` / `SQLiteUserRepository`
- `IMessageRepository` / `SQLiteMessageRepository`

#### `services/` ‚Äî –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
–°–µ—Ä–≤–∏—Å—ã —Å –æ—Å–Ω–æ–≤–Ω–æ–π –ª–æ–≥–∏–∫–æ–π –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:
- `UserService` ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- `MessageService` ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
- `ExportService` ‚Äî —ç–∫—Å–ø–æ—Ä—Ç –≤ Excel
- `AdminService` üÜï ‚Äî –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –∏ —Ä–∞—Å—Å—ã–ª–∫–∏
- `AdminStateManager` üÜï ‚Äî —Å–æ—Å—Ç–æ—è–Ω–∏—è –∞–¥–º–∏–Ω–æ–≤ (Singleton)

#### `handlers/` ‚Äî –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
`UpdateHandler` –º–∞—Ä—à—Ä—É—Ç–∏–∑–∏—Ä—É–µ—Ç —Å–æ–±—ã—Ç–∏—è –ø–æ —Ç–∏–ø–∞–º –∏ –¥–µ–ª–µ–≥–∏—Ä—É–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É —Å–µ—Ä–≤–∏—Å–∞–º.

#### `utils/` ‚Äî —É—Ç–∏–ª–∏—Ç—ã üÜï
- `admin_constants.py` ‚Äî –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã –¥–ª—è –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ (callback, —Å–æ–æ–±—â–µ–Ω–∏—è, –∫–Ω–æ–ø–∫–∏)

---

## üîß –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤–æ–π —Ñ—É–Ω–∫—Ü–∏–∏

1. –°–æ–∑–¥–∞–π—Ç–µ –º–æ–¥–µ–ª—å –≤ `models/` –µ—Å–ª–∏ –Ω—É–∂–Ω–∞ –Ω–æ–≤–∞—è —Å—É—â–Ω–æ—Å—Ç—å
2. –î–æ–±–∞–≤—å—Ç–µ –º–µ—Ç–æ–¥—ã –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π `repositories/`
3. –î–æ–±–∞–≤—å—Ç–µ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫—É –≤ —Å–µ—Ä–≤–∏—Å `services/`
4. –î–æ–±–∞–≤—å—Ç–µ –æ–±—Ä–∞–±–æ—Ç–∫—É –≤ `handlers/update_handler.py`

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–æ–±–∞–≤–∏—Ç—å unit-—Ç–µ—Å—Ç—ã –±–ª–∞–≥–æ–¥–∞—Ä—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤:

```python
# –ü—Ä–∏–º–µ—Ä: —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ UserService
class TestUserService:
    def test_register_new_user(self, mock_repository, mock_api):
        service = UserService(mock_repository, mock_api, settings)
        user = service.register_or_update_user(123, "Test User")
        assert user.name == "Test User"
```

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ —Ä–∞—Å—Å—ã–ª–∫–∏ üÜï

**–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
```env
NOTIFICATION_DELAY=0.05               # –ë—ã—Å—Ç—Ä–∞—è —Ä–∞—Å—Å—ã–ª–∫–∞
NOTIFICATION_PROGRESS_INTERVAL=10     # –ß–∞—Å—Ç—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
```

**–î–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω–∞ (–º–∞–ª–∞—è –±–∞–∑–∞ –¥–æ 500 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π):**
```env
NOTIFICATION_DELAY=0.1                # 10 —Å–æ–æ–±—â–µ–Ω–∏–π/—Å–µ–∫
NOTIFICATION_PROGRESS_INTERVAL=50     # –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–∞–∂–¥—ã–µ 50 —Å–æ–æ–±—â–µ–Ω–∏–π
```

**–î–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω–∞ (—Å—Ä–µ–¥–Ω—è—è –±–∞–∑–∞ –¥–æ 5000 –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π):**
```env
NOTIFICATION_DELAY=0.1                # 10 —Å–æ–æ–±—â–µ–Ω–∏–π/—Å–µ–∫
NOTIFICATION_PROGRESS_INTERVAL=100    # –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–∞–∂–¥—ã–µ 100 —Å–æ–æ–±—â–µ–Ω–∏–π
```

**–î–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω–∞ (–±–æ–ª—å—à–∞—è –±–∞–∑–∞ 10000+ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π):**
```env
NOTIFICATION_DELAY=0.15               # 6-7 —Å–æ–æ–±—â–µ–Ω–∏–π/—Å–µ–∫ (–±–µ–∑–æ–ø–∞—Å–Ω–µ–µ)
NOTIFICATION_PROGRESS_INTERVAL=500    # –û–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–∞–∂–¥—ã–µ 500 —Å–æ–æ–±—â–µ–Ω–∏–π
```

---

## üêõ –û—Ç–ª–∞–¥–∫–∞

### Debug —Ä–µ–∂–∏–º

–í–∫–ª—é—á–∏—Ç–µ DEBUG –≤ `.env`:
```env
DEBUG=true
```

–ü—Ä–∏ –æ—à–∏–±–∫–µ –≤—ã —É–≤–∏–¥–∏—Ç–µ –ø–æ–ª–Ω—ã–π traceback.

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–î–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ `print()`. –í –±—É–¥—É—â–µ–º —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø–µ—Ä–µ–π—Ç–∏ –Ω–∞ –º–æ–¥—É–ª—å `logging`:

```python
import logging

logger = logging.getLogger(__name__)
logger.info("–°–æ–æ–±—â–µ–Ω–∏–µ")
logger.error("–û—à–∏–±–∫–∞")
```

### –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

| –ü—Ä–æ–±–ª–µ–º–∞ | –†–µ—à–µ–Ω–∏–µ |
|----------|---------|
| `ValueError: –û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞` | –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π–ª `.env` |
| `sqlite3.OperationalError: database is locked` | –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –±–æ—Ç –Ω–µ –∑–∞–ø—É—â–µ–Ω –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –ø—Ä–æ—Ü–µ—Å—Å–∞—Ö |
| `MaxApiTimeoutError` | –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ –ø—Ä–∏ long polling, –±–æ—Ç —Å–∞–º –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è |
| `429 Too Many Requests` –ø—Ä–∏ —Ä–∞—Å—Å—ã–ª–∫–µ | –£–≤–µ–ª–∏—á—å—Ç–µ `NOTIFICATION_DELAY` –¥–æ 0.2 |
| –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –Ω–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è | –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤–∞—à user_id –µ—Å—Ç—å –≤ `ADMIN_USER_IDS` |
| –†–∞—Å—Å—ã–ª–∫–∞ –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç—Å—è | –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏, –≤–æ–∑–º–æ–∂–Ω–æ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –≤ —Ñ–æ–Ω–æ–≤–æ–º –ø–æ—Ç–æ–∫–µ |

---

## üìä –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

### –°—Ö–µ–º–∞ SQLite

#### –¢–∞–±–ª–∏—Ü–∞ `users`
```sql
CREATE TABLE users (
    user_id INTEGER PRIMARY KEY,
    name TEXT NOT NULL,
    phone_number TEXT,
    first_contact TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    last_contact TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

#### –¢–∞–±–ª–∏—Ü–∞ `messages`
```sql
CREATE TABLE messages (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    user_id INTEGER NOT NULL,
    text TEXT NOT NULL,
    direction TEXT NOT NULL,  -- 'from_user' –∏–ª–∏ 'to_user'
    operator_name TEXT,
    timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(user_id)
);
```

#### –¢–∞–±–ª–∏—Ü–∞ `message_mapping`
```sql
CREATE TABLE message_mapping (
    message_id TEXT PRIMARY KEY,
    user_id INTEGER NOT NULL,
    user_name TEXT,
    question_text TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

---

## üöÄ –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –†–∞—Å—Å—ã–ª–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

**–†–∞—Å—á—ë—Ç –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:**

| –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π | NOTIFICATION_DELAY | –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è | –ü—Ä–æ–≥—Ä–µ—Å—Å-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π |
|--------------|-------------------|-----------------|---------------------|
| 100 | 0.1 —Å–µ–∫ | ~10 —Å–µ–∫—É–Ω–¥ | 2 |
| 500 | 0.1 —Å–µ–∫ | ~50 —Å–µ–∫—É–Ω–¥ | 5 |
| 1000 | 0.1 —Å–µ–∫ | ~1 –º–∏–Ω 40 —Å–µ–∫ | 10 |
| 5000 | 0.15 —Å–µ–∫ | ~12 –º–∏–Ω—É—Ç | 10 |
| 10000 | 0.15 —Å–µ–∫ | ~25 –º–∏–Ω—É—Ç | 20 |

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:**
- –†–∞—Å—Å—ã–ª–∫–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ —Ñ–æ–Ω–æ–≤–æ–º –ø–æ—Ç–æ–∫–µ
- –ë–æ—Ç –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è –≤–æ –≤—Ä–µ–º—è —Ä–∞—Å—Å—ã–ª–∫–∏
- –î–ª—è –±–æ–ª—å—à–∏—Ö –±–∞–∑ (5000+) –ø–ª–∞–Ω–∏—Ä—É–π—Ç–µ —Ä–∞—Å—Å—ã–ª–∫–∏ –Ω–∞ –Ω–µ—Ä–∞–±–æ—á–µ–µ –≤—Ä–µ–º—è
- –ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –æ—à–∏–±–æ–∫ ‚Äî –≤—ã—Å–æ–∫–∏–π –ø—Ä–æ—Ü–µ–Ω—Ç "–Ω–µ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–ª–∏" –º–æ–∂–µ—Ç —É–∫–∞–∑—ã–≤–∞—Ç—å –Ω–∞ —É—Å—Ç–∞—Ä–µ–≤—à—É—é –±–∞–∑—É

---

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

–ü—Ä–æ–µ–∫—Ç LaVita Yarn Support Bot. –í—Å–µ –ø—Ä–∞–≤–∞ –∑–∞—â–∏—â–µ–Ω—ã.

---

## ü§ù –ö–æ–Ω—Ç–∞–∫—Ç—ã

–î–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤ –∏ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π:
- üìß Email: support@lavita.ru
- üí¨ Telegram: @lavita_support

---

**–í–µ—Ä—Å–∏—è:** 2.0.0 üÜï  
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** –§–µ–≤—Ä–∞–ª—å 2026  
**–°—Ç–∞—Ç—É—Å:** Production Ready ‚úÖ

### Changelog 2.0.0

**–ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**
- ‚ú® –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å —Å –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–º –º–µ–Ω—é
- ‚ú® –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –º–∞—Å—Å–æ–≤—ã—Ö —Ä–∞—Å—Å—ã–ª–æ–∫
- ‚ú® –ü—Ä–æ–≥—Ä–µ—Å—Å-—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
- ‚ú® –ü–æ–¥–¥–µ—Ä–∂–∫–∞ inline-–∫–ª–∞–≤–∏–∞—Ç—É—Ä –∏ callback-—Å–æ–±—ã—Ç–∏–π
- ‚ú® –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è–º–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤
- ‚ú® –î–µ—Ç–∞–ª—å–Ω–∞—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è –æ—à–∏–±–æ–∫ —Ä–∞—Å—Å—ã–ª–∫–∏
- ‚ú® –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —Ä–∞—Å—Å—ã–ª–∫–∏ (—Å–∫–æ—Ä–æ—Å—Ç—å, —á–∞—Å—Ç–æ—Ç–∞ –æ—Ç—á—ë—Ç–æ–≤)
- ‚ú® –°–±–æ—Ä –Ω–æ–º–µ—Ä–æ–≤ —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

**–£–ª—É—á—à–µ–Ω–∏—è:**
- üîß Rate limiting protection –¥–ª—è –º–∞—Å—Å–æ–≤—ã—Ö —Ä–∞—Å—Å—ã–ª–æ–∫
- üîß –§–æ–Ω–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç –æ—Å–Ω–æ–≤–Ω—É—é —Ä–∞–±–æ—Ç—É –±–æ—Ç–∞
- üîß –†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å retry –ª–æ–≥–∏–∫–æ–π
- üîß –û–±–Ω–æ–≤–ª—ë–Ω–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å AdminService –∏ AdminStateManager